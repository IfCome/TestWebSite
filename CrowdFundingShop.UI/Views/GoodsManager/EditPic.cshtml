@{
    Layout = null;
}
<!doctype html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>新增商品</title>
    <meta name="description" content="新增商品">
    <meta name="keywords" content="新增商品">
    @Html.Partial("~/Views/Common/SharePart.cshtml")
</head>
<body>
    <header class="am-topbar admin-header">
        @Html.Partial("~/Views/Common/TopBar.cshtml")
    </header>
    <div class="am-cf admin-main">
        <!-- content start -->
        <div class="admin-content">
            <ol class="am-breadcrumb">
                <li><a href="~/Home/IndexPage" class="am-icon-home">首页</a></li>
                <li><a href="~/GoodsManager/IndexPage">商品管理</a></li>
                <li class="am-active">新增商品</li>
            </ol>
            <hr />
            <div class="am-g">
                <div class="am-u-sm-12 am-u-md-4 am-u-md-push-8">
                    <div class="am-container am-hide-sm-only" style=" height: 50px; "></div>
                </div>
                <div class="am-u-sm-12 am-u-md-8 am-u-md-pull-4">
                    <form class="am-form am-form-horizontal" id="formAddUserInfo">
                        <div class="am-form-group">
                            <label for="goods-name" class="am-u-sm-3 am-form-label"> 展示图片</label>
                            <div class="am-panel-bd">
                                <div class="am-g">
                                    <div class="am-u-md-4">
                                        <div class="am-form-group am-form-file">
                                            <button id="uploadFileButton" type="button" class="am-btn am-btn-danger am-btn-sm">
                                                <i class="am-icon-cloud-upload"></i> 选择要上传的文件
                                            </button>
                                            <input id="doc-form-file" name="userIcon" type="file" accept="image/gif, image/jpeg, image/png">
                                            <button id="uploadImg" type="button" style="display:none" class="am-btn am-btn-danger am-btn-sm">
                                                <i class="am-icon-cloud-upload"></i> 开始上传
                                            </button>
                                            <button id="exitUpload" type="button" style="display:none" class="am-btn am-btn-danger am-btn-sm">
                                                <i class="am-icon-remove"></i> 取消
                                            </button>
                                        </div>
                                        <div id="file-list"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="am-form-group">
                            <div class="am-u-sm-9 am-u-sm-push-3">
                                <button id="btncommit" type="button" class="am-btn am-btn-primary">确认</button>
                                不上传，返回商品列表
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- content end -->
    </div>
    @Html.Partial("~/Views/Common/FootPart.cshtml")
</body>
</html>
<script>

    $(function () {
        //bindFunction();
    });

    // 绑定事件
    function bindFunction() {
        // 文本框获取焦点，隐藏tips
        $('input').focus(function () {
            if (tipInput && $(this).attr('id') == tipInput.attr('id')) {
                tipInput.removeClass('am-field-error').parent().parent().removeClass('am-form-error');
                tipInput = null;
                hideToolTips();
            }
        });
        // 提交用户信息
        $('#btncommit').click(commitUserInfo);
    }

    var data = {};
    var tipInput;
    function commitUserInfo() {
        data.RoleType = $('input[name=userRole]:checked').val();
        data.GoodsName = $.trim($('#goods-name').val());
        data.Describe = $.trim($('#goods-describe').val());
        data.Price = $.trim($('#goods-price').val());
        data.Category = $('#goods-category').val();
        if (checkData()) {
            // 提交数据
            $.post('@Url.RouteUrl(new { controller = "GoodsManager", action = "AddGoodsCallBack" })', data, function (result) {
                if (result && result.Message == 'OK') {
                    location.href = '/UserInfo/IndexPage';
                }
                else {
                    if (result.ErrorType == 'GoodsName') {
                        tipInput = $('#goods-name');
                    } else if (result.ErrorType == 'Describe') {
                        tipInput = $('#goods-describe');
                    } else if (result.ErrorType == 'Price') {
                        tipInput = $('#goods-price');
                    } else if (result.ErrorType == 'Category') {
                        tipInput = $('#goods-price');
                    } else {
                        tipInput = null;
                        alert(result.Message);
                        return;
                    }
                    showToolTips(tipInput, result.Message);
                    tipInput.addClass('am-field-error').parent().parent().addClass('am-form-error');
                }
            }, 'JSON');
        }
    }

    function checkData() {
        var reg = /^[0-9]+([.]{1}[0-9]+){0,1}$/;
        if (!data.GoodsName || data.GoodsName.length == 0) {
            tipInput = $('#goods-name');
            showToolTips(tipInput, "请输入商品名");
            tipInput.addClass('am-field-error').parent().parent().addClass('am-form-error');
            return false;
        }
        if (!data.Describe || data.Describe.length < 10) {
            tipInput = $('#goods-describe');
            showToolTips(tipInput, "商品描述必须大于10个字");
            tipInput.addClass('am-field-error').parent().parent().addClass('am-form-error');
            return false;
        }
        if (!reg.test(data.Price)) {
            tipInput = $('#goods-price');
            showToolTips(tipInput, "价格填写不正确");
            tipInput.addClass('am-field-error').parent().parent().addClass('am-form-error');
            return false;
        }
        return true;
    }
</script>
